var b=Object.defineProperty;var y=(r,e,s)=>e in r?b(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var t=(r,e,s)=>y(r,typeof e!="symbol"?e+"":e,s);import"./modulepreload-polyfill-B5Qt9EMX.js";class p{constructor(e){t(this,"playerElement");this.playerElement=e}update(e){const s=e.reduce((n,a)=>n+a,0);this.playerElement.innerHTML=`${e.join(", ")} (Total: ${s})`}}class m{constructor(e){t(this,"playerElement");this.playerElement=e}update(e){e&&this.playerElement.classList.add("winner")}}class ${constructor(e){t(this,"debugElement");this.debugElement=e}update(e){const s=this.debugElement.innerHTML;this.debugElement.innerHTML=s?`${s}, ${e}`:`${e}`}}class i{constructor(){t(this,"subscribers",[])}subscribe(e){this.getSubscriberIndex(e)===-1&&this.subscribers.push(e)}unsubscribe(e){const s=this.getSubscriberIndex(e);s!==-1&&this.subscribers.splice(s,1)}notify(e){this.subscribers.forEach(s=>s.update(e))}getSubscriberIndex(e){return this.subscribers.findIndex(s=>s===e)}}class g extends i{constructor(s){super();t(this,"playersCount");t(this,"currentPlayerIndex",0);this.playersCount=s}next(){const s=this.currentPlayerIndex;this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.playersCount,this.notify(s)}}class f{constructor(){t(this,"diceResults",[]);t(this,"results$",new i);t(this,"winStatus$",new i)}addDiceResult(e){this.diceResults.push(e),this.results$.notify(this.diceResults)}checkWinStatus(){this.diceResults.reduce((s,n)=>s+n,0)>=21?this.winStatus$.notify(!0):this.winStatus$.notify(!1)}update(e){this.addDiceResult(e),this.checkWinStatus()}}function w(r){const e=new Uint32Array(1),n=crypto.getRandomValues(e)[0]/4294967296;return Math.floor(n*r+1)}class E extends i{constructor(s){super();t(this,"sidesCount");this.sidesCount=s}roll(){const s=w(this.sidesCount);return this.notify(s),s}}class x{constructor(e,s,n,a){t(this,"players");t(this,"turnGenerator$");t(this,"diceGenerator$");t(this,"debugPublisher$");t(this,"debugDisplayer");this.players=new Array(e).fill(null).map(()=>new f),this.turnGenerator$=new g(e),this.diceGenerator$=new E(s),this.debugPublisher$=new i,this.debugDisplayer=new $(a),this.players.forEach((u,l)=>{const c=new p(n[l]),o=new m(n[l]);u.results$.subscribe(c),u.winStatus$.subscribe(o)}),this.turnGenerator$.subscribe({update:u=>{const l=this.players[u];this.players.forEach(o=>this.diceGenerator$.unsubscribe(o)),this.diceGenerator$.subscribe(l);const c=this.diceGenerator$.roll();this.debugPublisher$.notify(c)}}),this.debugPublisher$.subscribe(this.debugDisplayer)}playTurn(){this.turnGenerator$.next()}}const I=document.getElementsByClassName("player-result"),h=Array.from(I),D=h.length,G=document.getElementsByClassName("debug-rolls")[0],R=new x(D,6,h,G);var d;(d=document.getElementById("roll-dice"))==null||d.addEventListener("click",()=>{R.playTurn()});
