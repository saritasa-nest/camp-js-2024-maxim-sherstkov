var y=Object.defineProperty;var b=(r,e,t)=>e in r?y(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>b(r,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill-B5Qt9EMX.js";function m(r){const e=new Uint32Array(1),n=crypto.getRandomValues(e)[0]/4294967296;return Math.floor(n*r+1)}function o(r){return r.reduce((e,t)=>e+t,0)}class p{constructor(e){s(this,"playerElement");s(this,"resultsContent","");this.playerElement=e}update(e){const t=o(e);this.resultsContent=`${e.join(", ")} (Total: ${t})`,this.render()}render(){this.playerElement.innerHTML=this.resultsContent}}class E{constructor(e){s(this,"playerElement");s(this,"isWinner",!1);this.playerElement=e}update(e){this.isWinner=e,this.render()}render(){this.isWinner?this.playerElement.classList.add("winner"):this.playerElement.classList.remove("winner")}}class ${constructor(e){s(this,"historyElement");s(this,"historyContent","");this.historyElement=e}update(e){this.historyContent=this.historyContent?`${this.historyContent}, ${e}`:`${e}`,this.render()}render(){this.historyElement.innerHTML=this.historyContent}}class i{constructor(){s(this,"subscribers",[])}subscribe(e){this.getSubscriberIndex(e)===-1&&this.subscribers.push(e)}unsubscribe(e){const t=this.getSubscriberIndex(e);t!==-1&&this.subscribers.splice(t,1)}notify(e){this.subscribers.forEach(t=>t.update(e))}getSubscriberIndex(e){return this.subscribers.findIndex(t=>t===e)}}class f extends i{constructor(t){super();s(this,"playersCount");s(this,"currentPlayerIndex",0);this.playersCount=t}next(){const t=this.currentPlayerIndex;this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.playersCount,this.notify(t)}}class G{constructor(){s(this,"diceResults",[]);s(this,"results$",new i);s(this,"winStatus$",new i)}addDiceResult(e){this.diceResults.push(e),this.results$.notify(this.diceResults)}update(e){this.addDiceResult(e)}}class C extends i{constructor(t){super();s(this,"sidesCount");this.sidesCount=t}roll(){const t=m(this.sidesCount);return this.notify(t),t}}class w{constructor(e){s(this,"players");s(this,"turnGenerator$");s(this,"diceGenerator$");s(this,"historyPublisher$");s(this,"historyDisplayer");s(this,"isGameEnded");s(this,"rollDiceButton");s(this,"bondedPlayTurn");this.players=new Array(e.playersCount).fill(null).map(()=>new G),this.turnGenerator$=new f(e.playersCount),this.diceGenerator$=new C(e.diceSidesCount),this.historyPublisher$=new i,this.historyDisplayer=new $(e.historyElement),this.isGameEnded=!1,this.rollDiceButton=e.diceButtonElement,this.bondedPlayTurn=this.playTurn.bind(this),this.subscribePlayers(e.playerElements),this.subscribeToTurnGenerator(),this.historyPublisher$.subscribe(this.historyDisplayer)}playTurn(){this.turnGenerator$.next()}startGame(){var e;(e=this.rollDiceButton)==null||e.addEventListener("click",this.bondedPlayTurn)}evaluateGameResult(e,t){const n=o(e);this.checkGameEnd(n),t.winStatus$.notify(n>=21)}checkGameEnd(e){var t;e>=21&&(this.isGameEnded=!0,this.players.forEach(n=>this.diceGenerator$.unsubscribe(n)),(t=this.rollDiceButton)==null||t.removeEventListener("click",this.bondedPlayTurn))}subscribePlayers(e){this.players.forEach((t,n)=>{const l=new p(e[n]),c=new E(e[n]);t.results$.subscribe(l),t.winStatus$.subscribe(c),t.results$.subscribe({update:d=>{this.evaluateGameResult(d,t)}})})}subscribeToTurnGenerator(){this.turnGenerator$.subscribe({update:e=>{if(this.isGameEnded)return;const t=this.players[e];this.players.forEach(l=>this.diceGenerator$.unsubscribe(l)),this.diceGenerator$.subscribe(t);const n=this.diceGenerator$.roll();this.historyPublisher$.notify(n)}})}}const T=document.querySelectorAll(".player-result"),u=Array.from(T),P=u.length,a=document.getElementById("history-rolls"),h=document.getElementById("roll-dice");if(!a||!h)throw new Error("History or dice element not found");const x=6,I=new w({playersCount:P,diceSidesCount:x,playerElements:u,historyElement:a,diceButtonElement:h});I.startGame();
