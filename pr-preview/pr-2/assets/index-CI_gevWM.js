var o=Object.defineProperty;var d=(r,e,s)=>e in r?o(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var t=(r,e,s)=>d(r,typeof e!="symbol"?e+"":e,s);import"./modulepreload-polyfill-B5Qt9EMX.js";class h{constructor(e){t(this,"playerElement");this.playerElement=e}update(e){const s=e.reduce((n,i)=>n+i,0);this.playerElement.innerHTML=`${e.join(", ")} (Total: ${s})`}}class b{constructor(e){t(this,"playerElement");this.playerElement=e}update(e){e&&this.playerElement.classList.add("winner")}}class y{constructor(e){t(this,"debugElement");this.debugElement=e}update(e){const s=this.debugElement.innerHTML;this.debugElement.innerHTML=s?`${s}, ${e}`:`${e}`}}class l{constructor(){t(this,"subscribers",[])}subscribe(e){this.getSubscriberIndex(e)===-1&&this.subscribers.push(e)}unsubscribe(e){const s=this.getSubscriberIndex(e);s!==-1&&this.subscribers.splice(s,1)}notify(e){this.subscribers.forEach(s=>s.update(e))}getSubscriberIndex(e){return this.subscribers.findIndex(s=>s===e)}}class p extends l{constructor(s){super();t(this,"playersCount");t(this,"currentPlayerIndex",0);this.playersCount=s}next(){const s=this.currentPlayerIndex;this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.playersCount,this.notify(s)}}class m{constructor(){t(this,"diceResults",[]);t(this,"results$",new l);t(this,"winStatus$",new l)}addDiceResult(e){this.diceResults.push(e),this.results$.notify(this.diceResults)}checkWinStatus(){const e=this.diceResults.reduce((s,n)=>s+n,0);this.winStatus$.notify(e>=21)}update(e){this.addDiceResult(e),this.checkWinStatus()}}function g(r){const e=new Uint32Array(1),n=crypto.getRandomValues(e)[0]/4294967296;return Math.floor(n*r+1)}class E extends l{constructor(s){super();t(this,"sidesCount");this.sidesCount=s}roll(){const s=g(this.sidesCount);return this.notify(s),s}}class ${constructor(e){t(this,"players");t(this,"turnGenerator$");t(this,"diceGenerator$");t(this,"debugPublisher$");t(this,"debugDisplayer");this.players=new Array(e.playersCount).fill(null).map(()=>new m),this.turnGenerator$=new p(e.playersCount),this.diceGenerator$=new E(e.diceSidesCount),this.debugPublisher$=new l,this.debugDisplayer=new y(e.debugElement),this.players.forEach((s,n)=>{const i=new h(e.playerElements[n]),u=new b(e.playerElements[n]);s.results$.subscribe(i),s.winStatus$.subscribe(u)}),this.turnGenerator$.subscribe({update:s=>{const n=this.players[s];this.players.forEach(u=>this.diceGenerator$.unsubscribe(u)),this.diceGenerator$.subscribe(n);const i=this.diceGenerator$.roll();this.debugPublisher$.notify(i)}}),this.debugPublisher$.subscribe(this.debugDisplayer)}playTurn(){this.turnGenerator$.next()}}const C=document.getElementsByClassName("player-result"),c=Array.from(C),f=c.length,w=document.getElementsByClassName("debug-rolls")[0],x=6,I={playersCount:f,diceSidesCount:x,playerElements:c,debugElement:w},G=new $(I);var a;(a=document.getElementById("roll-dice"))==null||a.addEventListener("click",()=>{G.playTurn()});
